import { useState } from "react";

interface Decoracion {
  nombre: string;
  precio: number;
}

interface Tecnica {
  nombre: string;
  precio: number;
}

export default function Servicio() {
  const precioBase = 150;

  const decoracionesBase: Decoracion[] = [
    { nombre: "Piedras", precio: 10 },
    { nombre: "Sticker", precio: 5 },
    { nombre: "Glitter", precio: 8 },
  ];

  const tecnicas: Tecnica[] = [
    { nombre: "Acrílico", precio: 50 },
    { nombre: "Polygel", precio: 40 },
    { nombre: "Gelish", precio: 30 },
  ];

  const [cliente, setCliente] = useState("");
  const [decoraciones, setDecoraciones] = useState<number[]>(
    Array(decoracionesBase.length).fill(0)
  );
  const [tecnicaSeleccionada, setTecnicaSeleccionada] = useState<number | null>(null);

  const aumentar = (index: number) => {
    const nuevas = [...decoraciones];
    nuevas[index] += 1; // infinito
    setDecoraciones(nuevas);
  };

  const disminuir = (index: number) => {
    const nuevas = [...decoraciones];
    if (nuevas[index] > 0) {
      nuevas[index] -= 1;
    }
    setDecoraciones(nuevas);
  };

  const calcularTotal = () => {
    let total = precioBase;

    if (tecnicaSeleccionada !== null) {
      total += tecnicas[tecnicaSeleccionada].precio;
    }

    decoraciones.forEach((cantidad, index) => {
      total += cantidad * decoracionesBase[index].precio;
    });

    return total;
  };

  const generarTicket = () => {
    const total = calcularTotal();

    const resumenDecoraciones = decoracionesBase
      .map((dec, i) =>
        decoraciones[i] > 0
          ? `${dec.nombre} x${decoraciones[i]} - $${dec.precio * decoraciones[i]}`
          : null
      )
      .filter(Boolean)
      .join("\n");

    const tecnicaTexto =
      tecnicaSeleccionada !== null
        ? `${tecnicas[tecnicaSeleccionada].nombre} - $${tecnicas[tecnicaSeleccionada].precio}`
        : "Ninguna";

    const ticket = `
Cliente: ${cliente || "No especificado"}

Servicio base: $${precioBase}
Técnica: ${tecnicaTexto}

Decoraciones:
${resumenDecoraciones || "Ninguna"}

Total: $${total}
    `;

    alert(ticket);
  };

  return (
    <div className="p-6 max-w-xl mx-auto bg-white rounded-2xl shadow-lg space-y-6">

      {/* Nombre del cliente */}
      <div>
        <label className="block font-semibold mb-2">
          Nombre del cliente
        </label>
        <input
          type="text"
          value={cliente}
          onChange={(e) => setCliente(e.target.value)}
          className="w-full border rounded-xl p-3 outline-none"
          placeholder="Ingresa el nombre"
        />
      </div>

      {/* Técnicas */}
      <div>
        <h2 className="font-semibold mb-2">Técnica</h2>
        <div className="space-y-2">
          {tecnicas.map((tec, index) => (
            <button
              key={index}
              onClick={() => setTecnicaSeleccionada(index)}
              className={`w-full p-3 rounded-xl border ${
                tecnicaSeleccionada === index
                  ? "bg-black text-white"
                  : "bg-gray-100"
              }`}
            >
              {tec.nombre} - ${tec.precio}
            </button>
          ))}
        </div>
      </div>

      {/* Decoraciones */}
      <div>
        <h2 className="font-semibold mb-4">Decoraciones</h2>
        <div className="space-y-4">
          {decoracionesBase.map((dec, index) => (
            <div
              key={index}
              className="flex items-center justify-between bg-gray-100 p-3 rounded-xl"
            >
              <div>
                <p className="font-medium">{dec.nombre}</p>
                <p className="text-sm text-gray-500">${dec.precio}</p>
              </div>

              <div className="flex items-center gap-3">
                <button
                  onClick={() => disminuir(index)}
                  className="w-8 h-8 rounded-full bg-gray-300"
                >
                  -
                </button>

                <span className="font-semibold">
                  {decoraciones[index]}
                </span>

                <button
                  onClick={() => aumentar(index)}
                  className="w-8 h-8 rounded-full bg-gray-300"
                >
                  +
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Precio y botón generar ticket */}
      <div className="border-t pt-4 space-y-4">
        <div className="flex justify-between items-center">
          <span className="font-bold text-lg">Total:</span>
          <span className="font-bold text-xl">
            ${calcularTotal()}
          </span>
        </div>

        <button
          onClick={generarTicket}
          className="w-full bg-black text-white p-3 rounded-xl font-semibold"
        >
          Generar ticket
        </button>
      </div>
    </div>
  );
}
